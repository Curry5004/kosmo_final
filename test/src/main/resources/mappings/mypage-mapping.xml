<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MypageDAO">


<select id = "getUserInfo" resultType="user">
	select user_id, NAME, PASSWORD, BIRTHDAY, 
	GENDER, LOCATION, PHONE_NUM, JOIN_DATE, PROFILE_IMAGE
	,MODIFIED_DAY, MBTI_NAME
	from user as u
	join mbti as m
	on u.mbti_id=m.mbti_id
    where USER_ID=#{user_Id};
</select>

<update id = "updateUserInfo">
	UPDATE USER
	SET PASSWORD = #{password}, LOCATION=#{location}, PROFILE_IMAGE=#{profile_Image}
	, MODIFIED_DAY=now(), MBTI_PATH=#{mbti_Path}, MBTI_ID=#{mbti_Id} 
	WHERE user_Id = #{user_Id};
</update>

<select id ="getPartyMemberList" resultType="party">
	SELECT PARTY_ID, PARTY_TUMB_PATH
	FROM PARTY p JOIN MEMBER_LIST m on p.USER_ID=m.USER_ID
	WHERE ART_AVAILABLE = TRUE AND PARTY_ID = #{party_id} 
	ORDER BY ART_ID DESC 
	LIMIT #{listSize} OFFSET #{startRow}
	
	SELECT p.PARTY_ID, p.PARTY_TUMB_PATH, m.USER_ID
	FROM PARTY p
	INNER JOIN MEMBER_LIST m on p.PARTY_ID=m.PARTY_ID
	HERE ART_AVAILABLE = TRUE AND PARTY_ID = #{party_id} ;
	
	select u.name, u.user_id,MBTI_NAME 
	from member_list m join user u 	join mbti on m.user_id = u.user_id and u.mbti_id=mbti.MBTI_ID 
	where party_id ="${PARTY_ID}"
	order by reg_date;
</select>

<select id ="getPartyFavList" resultType="party">
	SELECT * FROM PARTY 
	WHERE ART_AVAILABLE = TRUE AND PARTY_ID = #{party_id}
	ORDER BY ART_ID DESC 
	LIMIT #{listSize} OFFSET #{startRow}
</select>

<select id ="getPartyCreatorList" resultType="party">
	SELECT * FROM PARTY 
	WHERE ART_AVAILABLE = TRUE AND PARTY_ID = #{party_id}
	ORDER BY ART_ID DESC 
	LIMIT #{listSize} OFFSET #{startRow}
</select>
	
</mapper>